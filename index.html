<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heartbeat Pursuit</title>
    <style>
        body { margin: 0; background: #000; color: #00ff88; font-family: 'Courier New', monospace; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        #start-screen { position: absolute; z-index: 1000; text-align: center; background: #000; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #game-ui { display: none; width: 100%; text-align: center; }
        
        /* è§’è‰²å€åŸŸ */
        .stage { display: flex; justify-content: space-around; align-items: center; width: 100%; height: 200px; position: relative; }
        .character { font-size: 50px; transition: transform 0.2s, opacity 0.2s; position: relative; }
        .character span { font-size: 14px; display: block; color: #00ff88; margin-top: 10px; }
        
        /* å¿ƒé›»åœ–ç·šæ¢ */
        #ecg-svg { position: absolute; width: 60%; height: 100px; z-index: -1; }
        #ecg-path { stroke: #00ff88; stroke-width: 4; fill: none; transition: d 0.1s; }

        #message { display: none; text-align: center; padding: 25px; border: 3px solid #00ff88; box-shadow: 0 0 30px #00ff88; background: #000; max-width: 80%; line-height: 1.8; z-index: 2000; }
        
        button { padding: 15px 40px; font-size: 20px; background: #00ff88; color: #000; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 0 20px #00ff88; }
        .miss { transform: translateX(50px) rotate(15deg) !important; opacity: 0.5; }
        .flash { animation: flash-bg 0.1s; }
        @keyframes flash-bg { from { background: #002211; } to { background: #000; } }
    </style>
</head>
<body onclick="handleTap()">

<div id="start-screen">
    <h1 style="margin-bottom: 40px;">å¿ƒå‹•ç¯€å¥æ¸¬è©¦ v4.0</h1>
    <button onclick="startGame(event)">é»æ“Šé–‹å§‹æ¸¬è©¦</button>
    <p style="margin-top: 20px; color: #444;">(è«‹ç¢ºä¿æ‰‹æ©ŸéŸ³é‡å·²é–‹å•Ÿ)</p>
</div>

<div id="game-ui">
    <div style="font-size: 20px; margin-bottom: 30px;">å¿ƒå‹•å€¼: <span id="score">0</span>%</div>
    
    <div class="stage">
        <div id="boy" class="character">ğŸ‘¦<span>ME</span></div>
        
        <svg id="ecg-svg" viewBox="0 0 400 100" preserveAspectRatio="none">
            <path id="ecg-path" d="M0,50 L400,50" />
        </svg>

        <div id="girl" class="character">ğŸ‘§<span>YOU</span></div>
    </div>
    
    <p style="color: #333; margin-top: 50px;">[ æŠ“ä½ç¯€å¥ï¼Œåˆ¥è®“å¥¹èº²é–‹ ]</p>
</div>

<div id="message">
    <p style="color:#ff2d55; font-size: 24px;">>> é€£ç·šæˆåŠŸ <<</p>
    <p>çœ‹ä¾†æˆ‘å€‘çš„å¿ƒè·³ç¯€å¥å·²ç¶“å®Œå…¨åŒæ­¥äº†ã€‚</p>
    <p>æˆ‘è¿½äº†ä½ æ•´å€‹ç¶²é ï¼Œ</p>
    <p>ç¾åœ¨ï¼Œæˆ‘æƒ³åœ¨ç¾å¯¦ä¸­è¿½åˆ°ä½ ã€‚</p>
    <hr style="border:0.5px solid #222; margin: 20px 0;">
    <p><b>ä½ é¡˜æ„è®“æˆ‘ç…§é¡§ä½ ï¼Œ<br>ç•¶æˆ‘çš„å¦ä¸€åŠå—ï¼Ÿ</b></p>
</div>

<audio id="bgm" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" type="audio/mpeg">
</audio>

<script>
    let tapCount = 0;
    let score = 0;
    let lastTapTime = 0;
    const audio = document.getElementById('bgm');
    const ecgPath = document.getElementById('ecg-path');
    const boy = document.getElementById('boy');
    const girl = document.getElementById('girl');

    function startGame(e) {
        e.stopPropagation();
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        audio.play().catch(err => alert("éŸ³è¨Šå•Ÿå‹•å¤±æ•—ï¼Œè«‹ç¢ºèªæ‰‹æ©ŸæœªéœéŸ³"));
    }

    function drawECG(isGood) {
        let amp = isGood ? 40 : 10;
        let d = `M0,50 L50,50 L60,${50-amp} L80,${50+amp} L100,50 L200,50 L210,${50-amp} L230,${50+amp} L250,50 L400,50`;
        ecgPath.setAttribute('d', d);
        setTimeout(() => ecgPath.setAttribute('d', "M0,50 L400,50"), 150);
    }

    function handleTap() {
        const now = Date.now();
        const delta = now - lastTapTime;
        lastTapTime = now;

        tapCount++;
        
        // ç°¡å–®çš„ç¯€å¥åˆ¤æ–· (å‡è¨­ç¯€å¥åœ¨å¤§ç´„ 500ms å·¦å³)
        let isGood = (delta > 400 && delta < 700) || tapCount === 1;

        if (isGood) {
            score += 7;
            girl.classList.remove('miss');
            boy.style.transform = "scale(1.2) translateX(10px)";
            girl.style.transform = "scale(1.2) translateX(-10px)";
            drawECG(true);
            document.body.classList.add('flash');
            setTimeout(() => document.body.classList.remove('flash'), 100);
        } else {
            // Miss: å¥³ç”Ÿèº²é–‹
            girl.classList.add('miss');
            boy.style.transform = "scale(1)";
            drawECG(false);
        }

        document.getElementById('score').innerText = Math.min(score, 100);

        if (score >= 100) {
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('message').style.display = 'block';
            audio.volume = 0.3;
        }
    }
</script>
</body>
</html>
