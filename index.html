<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heartbeat Chase</title>
    <style>
        body { margin: 0; background: #000; color: #00ff88; font-family: 'Courier New', monospace; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; touch-action: manipulation; }
        #start-screen { position: absolute; z-index: 1000; text-align: center; background: #000; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #game-ui { display: none; width: 100%; text-align: center; }
        .stage { display: flex; justify-content: space-around; align-items: center; width: 100%; height: 250px; position: relative; padding: 0 20px; box-sizing: border-box; }
        .character { font-size: 60px; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .character span { font-size: 12px; display: block; color: #00ff88; margin-top: 5px; opacity: 0.7; }
        #ecg-svg { position: absolute; width: 60%; height: 100px; z-index: -1; left: 20%; }
        #ecg-path { stroke: #00ff88; stroke-width: 4; fill: none; transition: d 0.1s; }
        #message { display: none; text-align: center; padding: 25px; border: 3px solid #00ff88; box-shadow: 0 0 30px #00ff88; background: #000; max-width: 80%; z-index: 2000; line-height: 1.8; }
        .btn { padding: 15px 40px; font-size: 20px; background: #00ff88; color: #000; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .miss-anim { transform: translateX(100px) scale(0.8); opacity: 0.3; }
        .flash { animation: flash-bg 0.15s; }
        @keyframes flash-bg { from { background: #003311; } to { background: #000; } }
        /* éš±è— YouTube æ’­æ”¾å™¨ */
        #player { position: absolute; top: -1000px; left: -1000px; }
    </style>
</head>
<body>

<div id="start-screen">
    <div style="font-size: 50px; margin-bottom: 20px;">ğŸ’“</div>
    <h2 style="margin-bottom: 40px;">å¿ƒå‹•ç¯€å¥æ¸¬è©¦</h2>
    <p style="color: #666; margin-bottom: 20px;">(é–‹å§‹å¾Œè«‹é»æ“Šç•«é¢ä¾†å‚³é€å¿ƒè·³)</p>
    <button class="btn" onclick="initGame()">é»æ“Šé–‹å§‹</button>
</div>

<div id="game-ui" onclick="handleTap()">
    <div style="font-size: 18px; margin-bottom: 20px;">åŒæ­¥ç‡: <span id="score">0</span>%</div>
    <div class="stage">
        <div id="boy" class="character">ğŸ‘¦<span>ME</span></div>
        <svg id="ecg-svg" viewBox="0 0 400 100" preserveAspectRatio="none">
            <path id="ecg-path" d="M0,50 L400,50" />
        </svg>
        <div id="girl" class="character">ğŸ‘§<span>YOU</span></div>
    </div>
</div>

<div id="message">
    <p style="color:#ff2d55; font-size: 22px; font-weight: bold;">>> åŒæ­¥å®Œæˆ <<</p>
    <p>é€™ä¸æ˜¯ Bugï¼Œè€Œæ˜¯æˆ‘å°å¦³å¿ƒè·³çš„å…±é³´ã€‚</p>
    <p>å¦³çœ‹ï¼Œæˆ‘å€‘é€£ç¯€å¥éƒ½é€™éº¼åˆæ‹ã€‚</p>
    <hr style="border:0.5px solid #333; margin: 20px 0;">
    <p style="font-size: 18px;"><b>æˆ‘å–œæ­¡å¦³ï¼Œ<br>å¦³é¡˜æ„è·Ÿæˆ‘åœ¨ä¸€èµ·å—ï¼Ÿ</b></p>
</div>

<div id="player"></div>

<script>
    let player;
    let score = 0;
    let lastTapTime = 0;
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    // åˆå§‹åŒ– YouTube æ’­æ”¾å™¨
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '0',
            width: '0',
            videoId: '4pT799n8Mec', // é€™æ˜¯ä¸€é¦–è¼•é¬†çš„ Lofi éŸ³æ¨‚
            events: {
                'onReady': (event) => { console.log("Music Ready"); }
            }
        });
    }

    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        if (player && player.playVideo) {
            player.playVideo();
        }
    }

    function drawECG(isHit) {
        const path = document.getElementById('ecg-path');
        let h = isHit ? 45 : 5;
        let d = `M0,50 L100,50 L120,${50-h} L140,${50+h} L160,50 L240,50 L260,${50-h} L280,${50+h} L300,50 L400,50`;
        path.setAttribute('d', d);
        path.style.stroke = isHit ? "#00ff88" : "#ff2d55";
        setTimeout(() => path.setAttribute('d', "M0,50 L400,50"), 150);
    }

    function handleTap() {
        const now = Date.now();
        const delta = now - lastTapTime;
        lastTapTime = now;

        // åˆ¤å®šï¼šç¬¬ä¸€æ¬¡é»æ“Šæˆ–é–“éš”åœ¨åˆç†ç¯„åœ
        let isHit = (delta > 300 && delta < 900) || score === 0;

        if (isHit) {
            score += 5;
            document.getElementById('girl').classList.remove('miss-anim');
            document.getElementById('boy').style.transform = "translateX(20px) scale(1.1)";
            document.getElementById('girl').style.transform = "translateX(-20px) scale(1.1)";
            document.body.classList.add('flash');
            setTimeout(() => document.body.classList.remove('flash'), 100);
            drawECG(true);
        } else {
            document.getElementById('girl').classList.add('miss-anim');
            document.getElementById('boy').style.transform = "translateX(0) scale(1)";
            drawECG(false);
        }

        document.getElementById('score').innerText = Math.min(score, 100);

        if (score >= 100) {
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('message').style.display = 'block';
            if (player && player.setVolume) player.setVolume(20);
        }
    }
</script>
</body>
</html>
