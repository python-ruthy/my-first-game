<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heartbeat Chase</title>
    <style>
        body { margin: 0; background: #000; color: #00ff88; font-family: 'Courier New', monospace; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; touch-action: manipulation; }
        #start-screen { position: absolute; z-index: 1000; text-align: center; background: #000; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #game-ui { display: none; width: 100%; text-align: center; }
        .stage { display: flex; justify-content: space-around; align-items: center; width: 100%; height: 250px; position: relative; }
        .character { font-size: 60px; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .character span { font-size: 12px; display: block; color: #00ff88; margin-top: 5px; opacity: 0.7; }
        #ecg-svg { position: absolute; width: 50%; height: 100px; z-index: -1; }
        #ecg-path { stroke: #00ff88; stroke-width: 4; fill: none; }
        #message { display: none; text-align: center; padding: 25px; border: 3px solid #00ff88; box-shadow: 0 0 30px #00ff88; background: #000; max-width: 80%; z-index: 2000; }
        .btn { padding: 15px 40px; font-size: 20px; background: #00ff88; color: #000; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 0 20px rgba(0,255,136,0.5); }
        .miss-anim { transform: translateX(80px) scale(0.8) rotate(20deg) !important; opacity: 0.3; }
        .hit-anim { transform: scale(1.2); text-shadow: 0 0 20px #00ff88; }
        .flash { animation: flash-bg 0.15s; }
        @keyframes flash-bg { from { background: #003311; } to { background: #000; } }
    </style>
</head>
<body>

<div id="start-screen">
    <div style="font-size: 50px; margin-bottom: 20px;">ğŸ’“</div>
    <h2 style="margin-bottom: 40px; letter-spacing: 5px;">å¿ƒå‹•ç¯€å¥æ¸¬è©¦</h2>
    <button class="btn" onclick="initGame()">é»æ“Šé€²å…¥æ¸¬è©¦</button>
</div>

<div id="game-ui" onclick="handleTap()">
    <div style="font-size: 18px; margin-bottom: 20px; opacity: 0.8;">åŒæ­¥ç‡: <span id="score">0</span>%</div>
    <div class="stage">
        <div id="boy" class="character">ğŸ‘¦<span>ME</span></div>
        <svg id="ecg-svg" viewBox="0 0 400 100" preserveAspectRatio="none">
            <path id="ecg-path" d="M0,50 L400,50" />
        </svg>
        <div id="girl" class="character">ğŸ‘§<span>YOU</span></div>
    </div>
    <p id="hint-text" style="color: #444; margin-top: 40px;">[ è½è‘—ç¯€å¥ï¼Œå‘å¥¹å‚³é€å¿ƒè·³ ]</p>
</div>

<div id="message">
    <p style="color:#ff2d55; font-size: 22px; font-weight: bold;">>> åŒæ­¥å®Œæˆ <<</p>
    <p>åŸä¾†å¦³ä¹Ÿä¸€ç›´åœ¨æˆ‘çš„é »ç‡ä¸Šã€‚</p>
    <p>é€™å€‹å°éŠæˆ²æˆ‘å¯«äº†å¾ˆä¹…ï¼Œ</p>
    <p>ä½†æƒ³å°å¦³èªªçš„è©±ï¼Œæˆ‘æº–å‚™å¾—æ›´ä¹…ã€‚</p>
    <hr style="border:0.5px solid #333; margin: 20px 0;">
    <p style="font-size: 18px;"><b>æˆ‘å–œæ­¡å¦³ï¼Œ<br>å¦³é¡˜æ„å’Œæˆ‘åœ¨ä¸€èµ·å—ï¼Ÿ</b></p>
</div>

<audio id="bgm" loop preload="auto">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script>
    let score = 0;
    let lastTapTime = 0;
    const audio = document.getElementById('bgm');
    const ecgPath = document.getElementById('ecg-path');
    const boy = document.getElementById('boy');
    const girl = document.getElementById('girl');
    const scoreEl = document.getElementById('score');

    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        audio.play(); // ç”±é»æ“Šè§¸ç™¼ï¼Œçµ•å°èƒ½æ”¾
        audio.volume = 0.6;
    }

    function drawECG(isHit) {
        let h = isHit ? 45 : 10;
        let d = `M0,50 L150,50 L160,${50-h} L180,${50+h} L200,50 L220,${50-h} L240,${50+h} L250,50 L400,50`;
        ecgPath.setAttribute('d', d);
        ecgPath.style.stroke = isHit ? "#00ff88" : "#ff2d55";
        setTimeout(() => ecgPath.setAttribute('d', "M0,50 L400,50"), 100);
    }

    function handleTap() {
        const now = Date.now();
        const delta = now - lastTapTime;
        
        // ç¯€å¥åˆ¤å®šï¼šé»æ“Šé–“éš”åœ¨ 400-800ms ä¹‹é–“ç®—æº–
        let isHit = (delta > 350 && delta < 850);
        lastTapTime = now;

        if (isHit || score === 0) {
            score += 5;
            girl.classList.remove('miss-anim');
            boy.style.transform = "scale(1.2) translateX(15px)";
            girl.style.transform = "scale(1.2) translateX(-15px)";
            document.body.classList.add('flash');
            setTimeout(() => document.body.classList.remove('flash'), 100);
            drawECG(true);
        } else {
            // Miss: å¥³ç”Ÿèº²é–‹
            girl.classList.add('miss-anim');
            boy.style.transform = "scale(1)";
            drawECG(false);
        }

        scoreEl.innerText = Math.min(score, 100);

        if (score >= 100) {
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('message').style.display = 'block';
            audio.animate({volume: 0.2}, 1000);
        }
    }
</script>
</body>
</html>
